import{r as d,f as F,k as x,m as _,n as o,q as r,x as I,p as a,Q as c,t as q,a9 as j,v as p,U as T,W as u,ar as $,an as E,a5 as C,a7 as M}from"./index-BCQP80hx.js";import{Q as O}from"./QBadge-Brhg3mLW.js";import{Q as z,a as B}from"./QTable-An4uF7Sr.js";import{Q as y,a as V}from"./QItem-rw1yFefp.js";import{Q as G}from"./QList-CHOuisuT.js";import{Q as L}from"./QMenu-DrHU5L3Z.js";import{Q as R}from"./QSpace-Bx88LnLJ.js";import{Q as W}from"./QSelect-DCR9V7w2.js";import{Q as H}from"./QForm-DzNt1E0B.js";import{Q as J}from"./QPage-DZO8eRE2.js";import{C as N}from"./ClosePopup-BHdM-OXe.js";import{u as K}from"./use-quasar-C6NPZew5.js";import{s as f}from"./supabase-3Ri18K4t.js";import"./use-fullscreen-BzphbkPZ.js";import"./selection-CdExz2ft.js";import"./QChip-BZCpNEhF.js";import"./QItemLabel-l38w8CTe.js";import"./format-CJebrXOQ.js";const X={class:"row items-center justify-between q-mb-lg"},Y={key:0,class:"flex flex-center bg-white rounded-borders q-pa-xl border-grey"},Z={class:"text-center"},ee={class:"text-h6"},ae={class:"row justify-end q-mt-lg"},Ve={__name:"TutorsPage",setup(le){const i=K(),v=d(""),b=d(!1),m=d(!1),s=d(!1),t=d({id:null,name:"",subject:"",email:"",phone:"",bank_name:"",bank_account_name:"",bank_account_number:"",bank_branch:""}),S=[{name:"name",align:"left",label:"Name",field:"name",sortable:!0},{name:"subject",align:"left",label:"Subject",field:"subject",sortable:!0},{name:"email",align:"left",label:"Email",field:"email"},{name:"phone",align:"left",label:"Phone",field:"phone"},{name:"actions",align:"right",label:"Actions",field:"actions"}],g=d([]),Q=d([]);F(()=>{k(),U()});const U=async()=>{const{data:n,error:e}=await f.from("subjects").select("name").order("name",{ascending:!0});!e&&n&&(Q.value=n.map(l=>l.name))},k=async()=>{s.value=!0;const{data:n,error:e}=await f.from("tutors").select("*").order("created_at",{ascending:!1});e?(console.error("Error fetching tutors:",e),i.notify({type:"negative",message:"Failed to load tutors"})):g.value=n,s.value=!1},w=()=>{m.value=!1,t.value={id:null,name:"",subject:"",email:"",phone:"",bank_name:"",bank_account_name:"",bank_account_number:"",bank_branch:""},b.value=!0},h=n=>{m.value=!0,t.value={...n},b.value=!0},A=async()=>{s.value=!0;const n={name:t.value.name,subject:t.value.subject,email:t.value.email,phone:t.value.phone,bank_name:t.value.bank_name,bank_account_name:t.value.bank_account_name,bank_account_number:t.value.bank_account_number,bank_branch:t.value.bank_branch};let e=null;if(m.value&&t.value.id){const{error:l}=await f.from("tutors").update(n).eq("id",t.value.id);e=l}else{const{error:l}=await f.from("tutors").insert([n]);e=l}s.value=!1,e?(console.error("Error saving tutor:",e),i.notify({type:"negative",message:"Error saving tutor"})):(i.notify({type:"positive",message:m.value?"Tutor updated":"Tutor added"}),b.value=!1,k())},D=n=>{i.dialog({title:"Confirm",message:"Are you sure you want to delete this tutor?",cancel:!0,persistent:!0}).onOk(async()=>{s.value=!0;const{error:e}=await f.from("tutors").delete().eq("id",n);s.value=!1,e?(console.error("Error deleting tutor:",e),i.notify({type:"negative",message:`Error deleting tutor: ${e.message}`})):(i.notify({type:"positive",message:"Tutor deleted successfully"}),k())})};return(n,e)=>(_(),x(J,{class:"q-pa-md"},{default:o(()=>[r("div",X,[e[10]||(e[10]=r("h1",{class:"text-h4 text-weight-bold text-grey-9 q-mb-none"},"Tutors",-1)),a(c,{color:"primary",icon:"person_add",label:"Add Tutor",unelevated:"","no-caps":"",onClick:w})]),g.value.length===0?(_(),I("div",Y,[r("div",Z,[a(q,{name:"person_off",size:"64px",color:"grey-4"}),e[11]||(e[11]=r("div",{class:"text-h6 text-grey-6 q-mt-md"},"No tutors found",-1)),e[12]||(e[12]=r("p",{class:"text-grey-5"},"Get started by adding a new tutor.",-1)),a(c,{color:"primary",label:"Add Tutor",unelevated:"","no-caps":"",class:"q-mt-sm",onClick:w})])])):(_(),x(j,{key:1,flat:"",bordered:"",class:"rounded-borders"},{default:o(()=>[a(z,{flat:"",rows:g.value,columns:S,"row-key":"id",filter:v.value},{"top-right":o(()=>[a(u,{borderless:"",dense:"",debounce:"300",modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),placeholder:"Search Tutors"},{append:o(()=>[a(q,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-subject":o(l=>[a(B,{props:l},{default:o(()=>[a(O,{color:"blue-1","text-color":"primary"},{default:o(()=>[p(T(l.value),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-actions":o(l=>[a(B,{props:l,"auto-width":""},{default:o(()=>[a(c,{flat:"",round:"",dense:"",color:"grey-7",icon:"more_vert"},{default:o(()=>[a(L,{cover:"","auto-close":""},{default:o(()=>[a(G,null,{default:o(()=>[a(y,{clickable:""},{default:o(()=>[a(V,null,{default:o(()=>[...e[13]||(e[13]=[p("View Profile",-1)])]),_:1})]),_:1}),a(y,{clickable:"",onClick:P=>h(l.row)},{default:o(()=>[a(V,null,{default:o(()=>[...e[14]||(e[14]=[p("Edit",-1)])]),_:1})]),_:1},8,["onClick"]),a(y,{clickable:"",class:"text-red",onClick:P=>D(l.row.id)},{default:o(()=>[a(V,null,{default:o(()=>[...e[15]||(e[15]=[p("Remove",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","filter"])]),_:1})),a($,{modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=l=>b.value=l)},{default:o(()=>[a(j,{style:{"min-width":"400px"}},{default:o(()=>[a(E,{class:"row items-center q-pb-none"},{default:o(()=>[r("div",ee,T(m.value?"Edit Tutor":"Add New Tutor"),1),a(R),C(a(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[N]])]),_:1}),a(E,{class:"q-pt-lg"},{default:o(()=>[a(H,{onSubmit:A,class:"q-gutter-md"},{default:o(()=>[a(u,{outlined:"",modelValue:t.value.name,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.name=l),label:"Full Name",rules:[l=>!!l||"Name is required"]},null,8,["modelValue","rules"]),a(W,{outlined:"",modelValue:t.value.subject,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.subject=l),options:Q.value,label:"Subject",loading:s.value},null,8,["modelValue","options","loading"]),a(u,{outlined:"",modelValue:t.value.email,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.email=l),label:"Email",type:"email"},null,8,["modelValue"]),a(u,{outlined:"",modelValue:t.value.phone,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.phone=l),label:"Phone Number",mask:"###-#######",hint:"Format: 077-1234567"},null,8,["modelValue"]),a(M,{class:"q-my-md"}),e[16]||(e[16]=r("div",{class:"text-subtitle2 text-grey-7 q-mb-sm"},"Bank Details (For Payments)",-1)),a(u,{outlined:"",modelValue:t.value.bank_name,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.bank_name=l),label:"Bank Name",dense:""},null,8,["modelValue"]),a(u,{outlined:"",modelValue:t.value.bank_account_name,"onUpdate:modelValue":e[6]||(e[6]=l=>t.value.bank_account_name=l),label:"Bank Account Name",dense:""},null,8,["modelValue"]),a(u,{outlined:"",modelValue:t.value.bank_account_number,"onUpdate:modelValue":e[7]||(e[7]=l=>t.value.bank_account_number=l),label:"Bank Account Number",dense:""},null,8,["modelValue"]),a(u,{outlined:"",modelValue:t.value.bank_branch,"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.bank_branch=l),label:"Bank Branch",dense:""},null,8,["modelValue"]),r("div",ae,[C(a(c,{label:"Cancel",color:"grey-7",flat:"",class:"q-mr-sm"},null,512),[[N]]),a(c,{label:m.value?"Update":"Save",type:"submit",color:"primary",unelevated:""},null,8,["label"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ve as default};
