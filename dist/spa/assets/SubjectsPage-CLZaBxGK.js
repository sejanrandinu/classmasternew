import{r as i,f as I,k as _,m as x,n as l,q as d,x as T,p as e,Q as u,t as p,a9 as S,v as w,U as V,W as f,ar as $,an as q,a5 as k}from"./index-BCQP80hx.js";import{Q as z}from"./QBadge-Brhg3mLW.js";import{Q as M,a as C}from"./QTable-An4uF7Sr.js";import{Q as D,a as v}from"./QItem-rw1yFefp.js";import{Q as O}from"./QList-CHOuisuT.js";import{Q as P}from"./QMenu-DrHU5L3Z.js";import{Q as F}from"./QSpace-Bx88LnLJ.js";import{Q as G}from"./QForm-DzNt1E0B.js";import{Q as H}from"./QPage-DZO8eRE2.js";import{C as E}from"./ClosePopup-BHdM-OXe.js";import{u as L}from"./use-quasar-C6NPZew5.js";import{s as b}from"./supabase-3Ri18K4t.js";import"./QSelect-DCR9V7w2.js";import"./QChip-BZCpNEhF.js";import"./QItemLabel-l38w8CTe.js";import"./format-CJebrXOQ.js";import"./use-fullscreen-BzphbkPZ.js";import"./selection-CdExz2ft.js";const W={class:"row items-center justify-between q-mb-lg"},J={key:0,class:"flex flex-center bg-white rounded-borders q-pa-xl border-grey"},K={class:"text-center"},R={class:"text-h6"},X={class:"row justify-end q-mt-lg"},ge={__name:"SubjectsPage",setup(Y){const c=L(),g=i(""),m=i(!1),n=i(!1),s=i(!1),h=[{name:"name",align:"left",label:"Name",field:"name",sortable:!0},{name:"code",align:"left",label:"Code",field:"code",sortable:!0},{name:"description",align:"left",label:"Description",field:"description"},{name:"actions",align:"right",label:"Actions",field:"actions"}],y=i([]),o=i({id:null,name:"",code:"",description:""});I(()=>{j()});const j=async()=>{s.value=!0;const{data:r,error:t}=await b.from("subjects").select("*").order("name",{ascending:!0});t?console.error("Error fetching subjects:",t):y.value=r,s.value=!1},Q=()=>{n.value=!1,o.value={id:null,name:"",code:"",description:""},m.value=!0},N=r=>{n.value=!0,o.value={...r},m.value=!0},A=async()=>{s.value=!0;const r={name:o.value.name,code:o.value.code,description:o.value.description};let t=null;if(n.value&&o.value.id){const{error:a}=await b.from("subjects").update(r).eq("id",o.value.id);t=a}else{const{error:a}=await b.from("subjects").insert([r]);t=a}s.value=!1,t?c.notify({type:"negative",message:`Error saving subject: ${t.message}`}):(c.notify({type:"positive",message:n.value?"Subject updated":"Subject added"}),m.value=!1,j())},U=r=>{c.dialog({title:"Confirm",message:"Are you sure you want to delete this subject?",cancel:!0,persistent:!0}).onOk(async()=>{s.value=!0;const{error:t}=await b.from("subjects").delete().eq("id",r);s.value=!1,t?c.notify({type:"negative",message:"Error deleting subject"}):(c.notify({type:"positive",message:"Subject deleted successfully"}),j())})};return(r,t)=>(x(),_(H,{class:"q-pa-md"},{default:l(()=>[d("div",W,[t[5]||(t[5]=d("h1",{class:"text-h4 text-weight-bold text-grey-9 q-mb-none"},"Subjects",-1)),e(u,{color:"primary",icon:"add_box",label:"Add Subject",unelevated:"","no-caps":"",onClick:Q})]),y.value.length===0&&!s.value?(x(),T("div",J,[d("div",K,[e(p,{name:"auto_stories",size:"64px",color:"grey-4"}),t[6]||(t[6]=d("div",{class:"text-h6 text-grey-6 q-mt-md"},"No subjects found",-1)),t[7]||(t[7]=d("p",{class:"text-grey-5"},"Get started by adding a new academic subject.",-1)),e(u,{color:"primary",label:"Add Subject",unelevated:"","no-caps":"",class:"q-mt-sm",onClick:Q})])])):(x(),_(S,{key:1,flat:"",bordered:"",class:"rounded-borders"},{default:l(()=>[e(M,{flat:"",rows:y.value,columns:h,"row-key":"id",filter:g.value,loading:s.value},{"top-right":l(()=>[e(f,{borderless:"",dense:"",debounce:"300",modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=a=>g.value=a),placeholder:"Search subjects"},{append:l(()=>[e(p,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-code":l(a=>[e(C,{props:a},{default:l(()=>[e(z,{color:"blue-1","text-color":"primary",class:"q-pa-xs px-sm"},{default:l(()=>[w(V(a.value||"NO CODE"),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-actions":l(a=>[e(C,{props:a,"auto-width":""},{default:l(()=>[e(u,{flat:"",round:"",dense:"",color:"grey-7",icon:"more_vert"},{default:l(()=>[e(P,{cover:"","auto-close":""},{default:l(()=>[e(O,null,{default:l(()=>[e(D,{clickable:"",onClick:B=>N(a.row)},{default:l(()=>[e(v,{avatar:"",style:{"min-width":"32px"}},{default:l(()=>[e(p,{name:"edit",size:"20px"})]),_:1}),e(v,null,{default:l(()=>[...t[8]||(t[8]=[w("Edit",-1)])]),_:1})]),_:1},8,["onClick"]),e(D,{clickable:"",class:"text-red",onClick:B=>U(a.row.id)},{default:l(()=>[e(v,{avatar:"",style:{"min-width":"32px"}},{default:l(()=>[e(p,{name:"delete",size:"20px",color:"red"})]),_:1}),e(v,null,{default:l(()=>[...t[9]||(t[9]=[w("Delete",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","filter","loading"])]),_:1})),e($,{modelValue:m.value,"onUpdate:modelValue":t[4]||(t[4]=a=>m.value=a)},{default:l(()=>[e(S,{style:{"min-width":"400px"}},{default:l(()=>[e(q,{class:"row items-center q-pb-none"},{default:l(()=>[d("div",R,V(n.value?"Edit Subject":"Add New Subject"),1),e(F),k(e(u,{icon:"close",flat:"",round:"",dense:""},null,512),[[E]])]),_:1}),e(q,{class:"q-pt-lg"},{default:l(()=>[e(G,{onSubmit:A,class:"q-gutter-md"},{default:l(()=>[e(f,{outlined:"",modelValue:o.value.name,"onUpdate:modelValue":t[1]||(t[1]=a=>o.value.name=a),label:"Subject Name",rules:[a=>!!a||"Name is required"]},null,8,["modelValue","rules"]),e(f,{outlined:"",modelValue:o.value.code,"onUpdate:modelValue":t[2]||(t[2]=a=>o.value.code=a),label:"Subject Code",placeholder:"e.g. MATH-01"},null,8,["modelValue"]),e(f,{outlined:"",modelValue:o.value.description,"onUpdate:modelValue":t[3]||(t[3]=a=>o.value.description=a),label:"Description",type:"textarea",rows:"3"},null,8,["modelValue"]),d("div",X,[k(e(u,{label:"Cancel",color:"grey-7",flat:"",class:"q-mr-sm"},null,512),[[E]]),e(u,{label:n.value?"Update":"Save",type:"submit",color:"primary",unelevated:"",loading:s.value},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{ge as default};
