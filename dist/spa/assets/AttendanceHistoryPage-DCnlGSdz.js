import{r as n,f as j,k as A,m as H,n as l,q as o,p as s,Q as w,a9 as x,t as p,W as g,U as h,v as T}from"./index-BCQP80hx.js";import{Q as L}from"./QSelect-DCR9V7w2.js";import{Q as N}from"./QChip-BZCpNEhF.js";import{Q as O,a as V}from"./QTable-An4uF7Sr.js";import{Q as $}from"./QPage-DZO8eRE2.js";import{s as S}from"./supabase-3Ri18K4t.js";import{u as R}from"./use-quasar-C6NPZew5.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QItem-rw1yFefp.js";import"./QItemLabel-l38w8CTe.js";import"./QMenu-DrHU5L3Z.js";import"./selection-CdExz2ft.js";import"./format-CJebrXOQ.js";import"./QList-CHOuisuT.js";import"./use-fullscreen-BzphbkPZ.js";const E={class:"row items-center justify-between q-mb-xl"},M={class:"row q-col-gutter-md items-end"},z={class:"col-12 col-md-4"},G={class:"col-12 col-md-3"},W={class:"col-12 col-md-3"},J={class:"col-12 col-md-2"},K={class:"text-weight-medium"},X={__name:"AttendanceHistoryPage",setup(Y){const Q=R(),f=n(!1),v=n(""),r=n([]),b=n([]),i=n(null),D=new Date().toISOString().split("T")[0],k=new Date(Date.now()-720*60*60*1e3).toISOString().split("T")[0],c=n(k),u=n(D),C=n({rowsPerPage:20}),q=[{name:"date",align:"left",label:"Date",field:"date",sortable:!0},{name:"student_name",align:"left",label:"Student Name",field:a=>a.students?.name,sortable:!0},{name:"student_id",align:"left",label:"Student ID",field:a=>a.students?.student_id,sortable:!0},{name:"class_name",align:"left",label:"Class",field:a=>a.classes?.class_name,sortable:!0},{name:"status",align:"center",label:"Status",field:"status",sortable:!0}];j(()=>{U(),m()});const U=async()=>{const{data:a}=await S.from("classes").select("id, class_name, grade").order("class_name");a&&(b.value=a.map(t=>({label:`${t.class_name} (${t.grade})`,value:t.id})))},m=async()=>{f.value=!0;let a=S.from("attendance").select(`
            id,
            date,
            status,
            students (name, student_id),
            classes (class_name)
        `).gte("date",c.value).lte("date",u.value).order("date",{ascending:!1});i.value&&(a=a.eq("class_id",i.value));const{data:t,error:e}=await a;e?(console.error("History error:",e),Q.notify({type:"negative",message:"Failed to load history"})):r.value=t||[],f.value=!1},B=a=>new Date(a).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}),I=()=>{const a=["Date","Student ID","Student Name","Class","Status"],t=r.value.map(d=>[d.date,d.students?.student_id,d.students?.name,d.classes?.class_name,d.status].join(",")),e=[a.join(","),...t].join(`
`),P=new Blob([e],{type:"text/csv"}),y=window.URL.createObjectURL(P),_=document.createElement("a");_.href=y,_.download=`Attendance_History_${c.value}_to_${u.value}.csv`,_.click(),window.URL.revokeObjectURL(y)};return(a,t)=>(H(),A($,{class:"q-pa-lg bg-grey-1"},{default:l(()=>[o("div",E,[t[4]||(t[4]=o("div",null,[o("h1",{class:"text-h3 text-weight-bolder text-grey-9 q-mb-xs mt-0"},"Attendance History"),o("div",{class:"text-subtitle1 text-grey-6"},"View and export past attendance records.")],-1)),s(w,{color:"primary",outline:"",icon:"arrow_back",label:"Back to Mark Attendance",to:"/dashboard/attendance","no-caps":""})]),s(x,{flat:"",class:"glass-modern q-pa-lg q-mb-lg"},{default:l(()=>[o("div",M,[o("div",z,[s(L,{filled:"",modelValue:i.value,"onUpdate:modelValue":[t[0]||(t[0]=e=>i.value=e),m],options:b.value,label:"Filter by Class","emit-value":"","map-options":"",clearable:""},{prepend:l(()=>[s(p,{name:"class",color:"primary"})]),_:1},8,["modelValue","options"])]),o("div",G,[s(g,{filled:"",modelValue:c.value,"onUpdate:modelValue":[t[1]||(t[1]=e=>c.value=e),m],label:"From",type:"date","stack-label":""},{prepend:l(()=>[s(p,{name:"event",color:"primary"})]),_:1},8,["modelValue"])]),o("div",W,[s(g,{filled:"",modelValue:u.value,"onUpdate:modelValue":[t[2]||(t[2]=e=>u.value=e),m],label:"To",type:"date","stack-label":""},{prepend:l(()=>[s(p,{name:"event",color:"primary"})]),_:1},8,["modelValue"])]),o("div",J,[s(w,{color:"secondary",icon:"download",label:"Export CSV",unelevated:"","no-caps":"",class:"full-width",onClick:I,disabled:r.value.length===0},null,8,["disabled"])])])]),_:1}),s(x,{flat:"",class:"glass-modern overflow-hidden"},{default:l(()=>[s(O,{flat:"",rows:r.value,columns:q,"row-key":"id",loading:f.value,filter:v.value,pagination:C.value},{"top-right":l(()=>[s(g,{borderless:"",dense:"",debounce:"300",modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=e=>v.value=e),placeholder:"Search students..."},{append:l(()=>[s(p,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-status":l(e=>[s(V,{props:e,class:"text-center"},{default:l(()=>[s(N,{color:e.row.status==="Present"?"green-1":"red-1","text-color":e.row.status==="Present"?"green-9":"red-9",size:"sm",class:"text-weight-bold"},{default:l(()=>[T(h(e.row.status),1)]),_:2},1032,["color","text-color"])]),_:2},1032,["props"])]),"body-cell-date":l(e=>[s(V,{props:e},{default:l(()=>[o("div",K,h(B(e.row.date)),1)]),_:2},1032,["props"])]),_:1},8,["rows","loading","filter","pagination"])]),_:1})]),_:1}))}},fe=F(X,[["__scopeId","data-v-2004ce87"]]);export{fe as default};
