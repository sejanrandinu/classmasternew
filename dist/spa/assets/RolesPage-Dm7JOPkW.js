import{r as c,f as M,k as b,m as r,n as o,q as t,p as s,Q as p,a9 as Q,an as f,a7 as T,v as q,t as R,U as y,x as d,V as h,F as x,S as w,ao as V,ar as j,a5 as C,W as S,ax as L,a8 as A}from"./index-BCQP80hx.js";import{Q as O,a as W}from"./QTable-An4uF7Sr.js";import{Q as G}from"./QChip-BZCpNEhF.js";import{Q as H}from"./QSpace-Bx88LnLJ.js";import{Q as J}from"./QItemLabel-l38w8CTe.js";import{Q as K,a as N}from"./QItem-rw1yFefp.js";import{Q as X}from"./QList-CHOuisuT.js";import{Q as Y}from"./QForm-DzNt1E0B.js";import{Q as Z}from"./QPage-DZO8eRE2.js";import{C as D}from"./ClosePopup-BHdM-OXe.js";import{u as ee}from"./use-quasar-C6NPZew5.js";import{s as k}from"./supabase-3Ri18K4t.js";import"./QSelect-DCR9V7w2.js";import"./QMenu-DrHU5L3Z.js";import"./selection-CdExz2ft.js";import"./format-CJebrXOQ.js";import"./use-fullscreen-BzphbkPZ.js";const le={class:"row items-center justify-between q-mb-lg"},se={class:"row q-col-gutter-lg"},te={class:"col-12 col-md-8"},oe={class:"row items-center"},ae={class:"col-12 col-md-4"},re={key:0,class:"text-grey-6 text-center q-pa-md bg-white rounded-borders border-grey"},ie={class:"row items-center justify-between"},ne={class:"text-subtitle1 text-weight-bold"},de={class:"text-caption opacity-80",style:{opacity:"0.9"}},ue={class:"row q-gutter-xs"},me={key:0,class:"text-grey-5 text-caption"},ce={class:"row q-gutter-xs"},pe=["onClick"],fe={class:"row justify-end q-mt-lg"},Ue={__name:"RolesPage",setup(ve){const u=ee(),v=c(!1),m=c(!1),a=c({id:null,name:"",description:"",color:"blue",permissions:[]}),P=[{label:"Manage Users (Students/Tutors)",value:"users"},{label:"Manage Finance",value:"finance"},{label:"Manage Classes",value:"classes"},{label:"View Reports",value:"reports"},{label:"System Settings",value:"settings"}],U=["red","pink","purple","deep-purple","indigo","blue","cyan","teal","green","orange","brown","grey"],g=c([]),$=c([]),z=[{name:"name",align:"left",label:"Name",field:"name"},{name:"email",align:"left",label:"Email",field:"email"},{name:"role",align:"left",label:"Role",field:"role"}];M(()=>{_()});const _=async()=>{m.value=!0;const{data:i,error:l}=await k.from("roles").select("*").order("id",{ascending:!0});l?console.error("Error fetching roles:",l):g.value=i,m.value=!1},B=()=>{a.value={id:null,name:"",description:"",color:"blue",permissions:[]},v.value=!0},E=async()=>{if(!a.value.name)return;m.value=!0;const i={name:a.value.name,description:a.value.description,color:a.value.color,permissions:a.value.permissions},{error:l}=await k.from("roles").insert([i]);m.value=!1,l?u.notify({type:"negative",message:`Error creating role: ${l.message}`}):(u.notify({type:"positive",message:"Role created successfully"}),v.value=!1,_())},F=i=>{u.dialog({title:"Confirm",message:"Are you sure you want to delete this role?",cancel:!0,persistent:!0}).onOk(async()=>{const{error:l}=await k.from("roles").delete().eq("id",i);l?u.notify({type:"negative",message:"Error deleting role"}):(u.notify({type:"positive",message:"Role deleted"}),_())})},I=i=>{const l=g.value.find(e=>e.name===i);return l?l.color:"grey"};return(i,l)=>(r(),b(Z,{class:"q-pa-md"},{default:o(()=>[t("div",le,[l[4]||(l[4]=t("h1",{class:"text-h4 text-weight-bold text-grey-9 q-mb-none"},"Staff & Roles",-1)),s(p,{color:"primary",icon:"security",label:"Create Role",unelevated:"","no-caps":"",onClick:B})]),t("div",se,[t("div",te,[s(Q,{flat:"",bordered:"",class:"rounded-borders"},{default:o(()=>[s(f,null,{default:o(()=>[...l[5]||(l[5]=[t("div",{class:"text-h6 text-weight-bold"},"Staff Members",-1)])]),_:1}),s(T),s(O,{flat:"",rows:$.value,columns:z,"row-key":"id","hide-bottom":""},{"body-cell-role":o(e=>[s(W,{props:e},{default:o(()=>[t("div",oe,[s(R,{name:"shield",size:"16px",class:"q-mr-xs",color:I(e.value)},null,8,["color"]),q(" "+y(e.value),1)])]),_:2},1032,["props"])]),_:1},8,["rows"])]),_:1})]),t("div",ae,[g.value.length===0?(r(),d("div",re," No roles defined. ")):h("",!0),(r(!0),d(x,null,w(g.value,e=>(r(),b(Q,{key:e.id,flat:"",bordered:"",class:"rounded-borders q-mb-md"},{default:o(()=>[s(f,{class:V(`bg-${e.color||"blue"} text-white`)},{default:o(()=>[t("div",ie,[t("div",null,[t("div",ne,y(e.name),1),t("div",de,y(e.description),1)]),s(p,{icon:"delete",flat:"",round:"",dense:"",color:"white",size:"sm",onClick:n=>F(e.id)},null,8,["onClick"])])]),_:2},1032,["class"]),s(f,null,{default:o(()=>[l[6]||(l[6]=t("div",{class:"text-caption text-grey-6 q-mb-sm text-weight-bold"},"Permissions:",-1)),t("div",ue,[(r(!0),d(x,null,w(e.permissions,n=>(r(),b(G,{key:n,size:"xs",icon:n==="users"?"group":"check",label:n,outline:"",color:"primary"},null,8,["icon","label"]))),128)),!e.permissions||e.permissions.length===0?(r(),d("span",me,"No specific permissions")):h("",!0)])]),_:2},1024)]),_:2},1024))),128))])]),s(j,{modelValue:v.value,"onUpdate:modelValue":l[3]||(l[3]=e=>v.value=e)},{default:o(()=>[s(Q,{style:{"min-width":"400px"}},{default:o(()=>[s(f,{class:"row items-center q-pb-none"},{default:o(()=>[l[7]||(l[7]=t("div",{class:"text-h6"},"Create New Role",-1)),s(H),C(s(p,{icon:"close",flat:"",round:"",dense:""},null,512),[[D]])]),_:1}),s(f,{class:"q-pt-lg"},{default:o(()=>[s(Y,{onSubmit:E,class:"q-gutter-md"},{default:o(()=>[s(S,{outlined:"",modelValue:a.value.name,"onUpdate:modelValue":l[0]||(l[0]=e=>a.value.name=e),label:"Role Name",rules:[e=>!!e||"Role Name is required"]},null,8,["modelValue","rules"]),t("div",null,[l[8]||(l[8]=t("div",{class:"text-caption q-mb-xs"},"Color Code",-1)),t("div",ce,[(r(),d(x,null,w(U,e=>t("div",{key:e,class:V(["cursor-pointer rounded-borders",[`bg-${e}`,a.value.color===e?"ring-2 ring-offset-1 ring-blue":""]]),style:{width:"24px",height:"24px"},onClick:n=>a.value.color=e},[a.value.color===e?(r(),b(R,{key:0,name:"check",color:"white",size:"16px",class:"absolute-center"})):h("",!0)],10,pe)),64))])]),s(S,{outlined:"",modelValue:a.value.description,"onUpdate:modelValue":l[1]||(l[1]=e=>a.value.description=e),label:"Description",type:"textarea",rows:"2"},null,8,["modelValue"]),t("div",null,[l[9]||(l[9]=t("div",{class:"text-caption q-mb-xs"},"Permissions",-1)),s(X,{bordered:"",separator:"",class:"rounded-borders"},{default:o(()=>[(r(),d(x,null,w(P,e=>C(s(K,{key:e.value,tag:"label",dense:""},{default:o(()=>[s(N,null,{default:o(()=>[s(J,null,{default:o(()=>[q(y(e.label),1)]),_:2},1024)]),_:2},1024),s(N,{side:"",top:""},{default:o(()=>[s(L,{modelValue:a.value.permissions,"onUpdate:modelValue":l[2]||(l[2]=n=>a.value.permissions=n),val:e.value},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024),[[A]])),64))]),_:1})]),t("div",fe,[C(s(p,{label:"Cancel",color:"grey-7",flat:"",class:"q-mr-sm"},null,512),[[D]]),s(p,{label:"Create Role",type:"submit",color:"primary",unelevated:"",loading:m.value},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ue as default};
