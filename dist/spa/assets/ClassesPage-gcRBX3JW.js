import{r as n,b as O,f as R,k as E,m as g,n as o,q as a,x as y,p as t,Q as u,t as d,F as H,S as W,a9 as A,ao as K,v as b,U as i,a7 as Y,an as V,s as J,ar as X,a5 as T,W as _}from"./index-BCQP80hx.js";import{Q as Z}from"./QBadge-Brhg3mLW.js";import{Q as ee}from"./QChip-BZCpNEhF.js";import{Q as U,a as x}from"./QItem-rw1yFefp.js";import{Q as te}from"./QList-CHOuisuT.js";import{Q as se}from"./QMenu-DrHU5L3Z.js";import{Q as h}from"./QSelect-DCR9V7w2.js";import{Q as ae}from"./QBtnToggle-ClMRll_7.js";import{Q as le}from"./QForm-DzNt1E0B.js";import{Q as oe}from"./QPage-DZO8eRE2.js";import{C as G}from"./ClosePopup-BHdM-OXe.js";import{u as re}from"./use-quasar-C6NPZew5.js";import{s as p}from"./supabase-3Ri18K4t.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./selection-CdExz2ft.js";import"./QItemLabel-l38w8CTe.js";import"./format-CJebrXOQ.js";const ie={class:"row items-center justify-between q-mb-xl"},ne={key:0,class:"flex flex-center q-pa-xl empty-container"},ue={class:"text-center fade-in"},ce={class:"icon-blob"},me={key:1,class:"row q-col-gutter-xl"},pe={class:"row items-center justify-between no-wrap"},ve={class:"row items-center"},fe={class:"text-h5 text-weight-bolder q-mt-md"},ge={class:"text-subtitle2 opacity-90"},ye={class:"row items-center q-mb-lg tutor-section q-pa-sm rounded-borders"},be={class:"text-subtitle1 text-weight-bold text-grey-9"},_e={class:"row items-center justify-between q-mb-lg bg-grey-1 q-pa-md rounded-borders border-dashed"},xe={class:"row items-center text-grey-7 q-mb-xs"},he={class:"text-caption text-weight-bold uppercase"},we={class:"text-h6 text-weight-bold text-grey-9"},qe={class:"row items-center justify-between q-mt-md"},Ce={class:"fee-badge"},Ve={class:"amount"},Qe={class:"row items-center justify-between"},je={class:"text-h5 text-weight-bolder"},ke={class:"row q-col-gutter-lg"},Se={class:"col-12 col-md-6"},Ae={class:"col-12 col-md-6"},Te={class:"row q-col-gutter-lg"},Ue={class:"col-12 col-md-4"},Ge={class:"col-6 col-md-4"},De={class:"col-6 col-md-4"},Ie={class:"row q-col-gutter-lg items-center"},Me={class:"col-12 col-md-7"},ze={class:"col-12 col-md-5"},Be={class:"row justify-end q-mt-xl"},Pe={__name:"ClassesPage",setup($e){const w=re(),q=n([]),c=n(!1),v=n(!1),f=n(!1),Q=n([]),j=n([]),D=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],I=["Grade 6","Grade 7","Grade 8","Grade 9","Grade 10","Grade 11","Grade 12","Grade 13"],l=n({id:null,class_name:"",subject:"",tutor:"",grade:"",day:"Sunday",start_time:"08:00",end_time:"10:00",fee:3500,status:"Active"}),M=O(()=>l.value.subject?j.value.filter(r=>r.subject===l.value.subject).map(r=>r.name):[]),z=()=>{l.value.tutor=""};R(()=>{C(),B()});const B=async()=>{const{data:r}=await p.from("subjects").select("name").order("name"),{data:e}=await p.from("tutors").select("name, subject").order("name");r&&(Q.value=r.map(s=>s.name)),e&&(j.value=e)},C=async()=>{c.value=!0;const{data:r,error:e}=await p.from("classes").select("*").order("created_at",{ascending:!1});e||(q.value=r),c.value=!1},k=()=>{f.value=!1,l.value={id:null,class_name:"",subject:"",tutor:"",grade:"",day:"Sunday",start_time:"08:00",end_time:"10:00",fee:3500,status:"Active"},v.value=!0},P=r=>{f.value=!0,l.value={...r},v.value=!0},$=async()=>{c.value=!0;const{id:r,...e}=l.value;f.value?await p.from("classes").update(e).eq("id",r):await p.from("classes").insert([e]),c.value=!1,v.value=!1,C(),w.notify({type:"positive",message:"Class schedule synced successfully"})},F=r=>{w.dialog({title:"Security Confirmation",message:"This will permanently remove the class and all associated data. Proceed?",cancel:!0,persistent:!0,ok:{color:"red-7",unelevated:!0,label:"Confirm Removal"}}).onOk(async()=>{await p.from("classes").delete().eq("id",r),C(),w.notify({type:"positive",message:"Class record purged"})})},N=r=>(r||"").split("").reduce((s,m)=>s+m.charCodeAt(0),0)%5+1,S=r=>{if(!r)return"";const[e,s]=r.split(":"),m=parseInt(e),L=m>=12?"PM":"AM";return`${m%12||12}:${s} ${L}`};return(r,e)=>(g(),E(oe,{class:"q-pa-lg bg-grey-1"},{default:o(()=>[a("div",ie,[e[10]||(e[10]=a("div",null,[a("h1",{class:"text-h3 text-weight-bolder text-grey-9 q-mb-xs mt-0"},"Class Management"),a("div",{class:"text-subtitle1 text-grey-6"},"Schedule, monitor, and manage your tuition sessions.")],-1)),t(u,{color:"primary",icon:"add",label:"Set Up New Class",unelevated:"","no-caps":"",class:"premium-btn q-px-lg",onClick:k})]),q.value.length===0&&!c.value?(g(),y("div",ne,[a("div",ue,[a("div",ce,[t(d,{name:"auto_awesome",size:"84px",color:"primary"})]),e[11]||(e[11]=a("div",{class:"text-h4 text-weight-bold text-grey-9 q-mt-lg"},"Your Schedule is Clear",-1)),e[12]||(e[12]=a("p",{class:"text-grey-6 text-h6 q-mt-md mw-400 mx-auto"},"It looks like you haven't scheduled any classes yet. Time to add your first session!",-1)),t(u,{color:"primary",label:"Create First Class",unelevated:"","no-caps":"",size:"lg",class:"q-mt-xl premium-btn",onClick:k})])])):(g(),y("div",me,[(g(!0),y(H,null,W(q.value,s=>(g(),y("div",{key:s.id,class:"col-12 col-sm-6 col-lg-4"},[t(A,{flat:"",class:"class-card glass-modern overflow-hidden"},{default:o(()=>[a("div",{class:K([`subject-header bg-gradient-${N(s.subject)}`,"q-pa-md text-white relative-position"])},[a("div",pe,[t(Z,{label:s.grade,color:"white","text-color":"primary",class:"text-weight-bold q-px-sm"},null,8,["label"]),a("div",ve,[t(ee,{dense:"",color:s.status==="Active"?"green-5":"grey-7","text-color":"white",size:"sm",class:"q-mr-sm"},{default:o(()=>[b(i(s.status),1)]),_:2},1032,["color"]),t(u,{flat:"",round:"",dense:"",color:"white",icon:"more_horiz",class:"opacity-80"},{default:o(()=>[t(se,{"auto-close":"","transition-show":"scale","transition-hide":"scale"},{default:o(()=>[t(te,{style:{"min-width":"180px"}},{default:o(()=>[t(U,{clickable:"",onClick:m=>P(s),class:"q-py-md"},{default:o(()=>[t(x,{avatar:""},{default:o(()=>[t(d,{name:"edit_calendar",color:"primary"})]),_:1}),t(x,null,{default:o(()=>[...e[13]||(e[13]=[b("Modify Schedule",-1)])]),_:1})]),_:1},8,["onClick"]),t(Y),t(U,{clickable:"",class:"text-red-7 q-py-md",onClick:m=>F(s.id)},{default:o(()=>[t(x,{avatar:""},{default:o(()=>[t(d,{name:"delete_outline",color:"red-7"})]),_:1}),t(x,null,{default:o(()=>[...e[14]||(e[14]=[b("Permanent Removal",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),a("div",fe,i(s.class_name),1),a("div",ge,i(s.subject),1)],2),t(V,{class:"q-pa-lg"},{default:o(()=>[a("div",ye,[t(J,{size:"44px",color:"primary","text-color":"white",class:"q-mr-md shadow-2"},{default:o(()=>[b(i(s.tutor?s.tutor.charAt(0):"?"),1)]),_:2},1024),a("div",null,[e[15]||(e[15]=a("div",{class:"text-caption text-grey-6 text-uppercase text-weight-bold letter-spacing-wide"},"Instructor",-1)),a("div",be,i(s.tutor||"No Tutor"),1)])]),a("div",_e,[a("div",null,[a("div",xe,[t(d,{name:"calendar_today",size:"16px",class:"q-mr-xs"}),a("span",he,i(s.day),1)]),a("div",we,i(S(s.start_time))+" - "+i(S(s.end_time)),1)]),t(d,{name:"arrow_forward",color:"grey-4",size:"24px"})]),a("div",qe,[a("div",Ce,[e[16]||(e[16]=a("span",{class:"currency"},"LKR",-1)),a("span",Ve,i(Number(s.fee).toLocaleString()),1),e[17]||(e[17]=a("span",{class:"period"},"/month",-1))]),t(u,{flat:"",color:"primary",label:"Details","no-caps":"","icon-right":"chevron_right"})])]),_:2},1024)]),_:2},1024)]))),128))])),t(X,{modelValue:v.value,"onUpdate:modelValue":e[9]||(e[9]=s=>v.value=s),"backdrop-filter":"blur(10px)"},{default:o(()=>[t(A,{style:{"min-width":"500px","border-radius":"20px"},class:"overflow-hidden shadow-24"},{default:o(()=>[t(V,{class:"bg-primary text-white q-pa-lg"},{default:o(()=>[a("div",Qe,[a("div",null,[a("div",je,i(f.value?"Update Class":"New Session Setup"),1),e[18]||(e[18]=a("div",{class:"text-subtitle2 opacity-80"},"Fill in the details for the tuition session",-1))]),T(t(u,{icon:"close",flat:"",round:"",dense:""},null,512),[[G]])])]),_:1}),t(V,{class:"q-pa-xl"},{default:o(()=>[t(le,{onSubmit:$,class:"q-gutter-lg"},{default:o(()=>[t(_,{filled:"",modelValue:l.value.class_name,"onUpdate:modelValue":e[0]||(e[0]=s=>l.value.class_name=s),label:"Class Header",placeholder:"e.g., Mathematics Mastery Weekly","label-color":"primary",rules:[s=>!!s||"Give your class a descriptive name"]},{prepend:o(()=>[t(d,{name:"edit_note",color:"primary"})]),_:1},8,["modelValue","rules"]),a("div",ke,[a("div",Se,[t(h,{filled:"",modelValue:l.value.subject,"onUpdate:modelValue":[e[1]||(e[1]=s=>l.value.subject=s),z],options:Q.value,label:"Subject Area"},{prepend:o(()=>[t(d,{name:"book",color:"primary"})]),_:1},8,["modelValue","options"])]),a("div",Ae,[t(h,{filled:"",modelValue:l.value.grade,"onUpdate:modelValue":e[2]||(e[2]=s=>l.value.grade=s),options:I,label:"Target Grade"},{prepend:o(()=>[t(d,{name:"grade",color:"primary"})]),_:1},8,["modelValue"])])]),t(h,{filled:"",modelValue:l.value.tutor,"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.tutor=s),options:M.value,label:"Assign Lead Tutor",hint:l.value.subject?`Tutors for ${l.value.subject}`:"Select a subject first"},{prepend:o(()=>[t(d,{name:"person_pin",color:"primary"})]),_:1},8,["modelValue","options","hint"]),a("div",Te,[a("div",Ue,[t(h,{filled:"",modelValue:l.value.day,"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.day=s),options:D,label:"Session Day"},null,8,["modelValue"])]),a("div",Ge,[t(_,{filled:"",modelValue:l.value.start_time,"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.start_time=s),label:"Beginning",type:"time","stack-label":""},null,8,["modelValue"])]),a("div",De,[t(_,{filled:"",modelValue:l.value.end_time,"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.end_time=s),label:"Conclusion",type:"time","stack-label":""},null,8,["modelValue"])])]),a("div",Ie,[a("div",Me,[t(_,{filled:"",modelValue:l.value.fee,"onUpdate:modelValue":e[7]||(e[7]=s=>l.value.fee=s),modelModifiers:{number:!0},label:"Admission Fee (LKR)",type:"number",prefix:"Rs."},{prepend:o(()=>[t(d,{name:"payments",color:"green-7"})]),_:1},8,["modelValue"])]),a("div",ze,[t(ae,{modelValue:l.value.status,"onUpdate:modelValue":e[8]||(e[8]=s=>l.value.status=s),spread:"","no-caps":"",unelevated:"","toggle-color":"primary",color:"grey-2","text-color":"grey-7",options:[{label:"Active",value:"Active"},{label:"Paused",value:"Inactive"}]},null,8,["modelValue"])])]),a("div",Be,[T(t(u,{label:"Discard",color:"grey-5",flat:"",class:"q-mr-md"},null,512),[[G]]),t(u,{label:f.value?"Sync Changes":"Confirm Class",type:"submit",color:"primary",unelevated:"",class:"q-px-xl premium-btn h-50",loading:c.value},null,8,["label","loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},ot=de(Pe,[["__scopeId","data-v-e61419b8"]]);export{ot as default};
