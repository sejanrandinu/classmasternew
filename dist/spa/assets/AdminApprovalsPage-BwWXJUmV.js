import{Q}from"./QBtnToggle-ClMRll_7.js";import{r as p,b as x,f as C,k as u,m,n as l,q as r,p as o,W as A,t as q,a9 as U,Q as f,v as V,U as B}from"./index-BCQP80hx.js";import{Q as D}from"./QBadge-Brhg3mLW.js";import{Q as $,a as w}from"./QTable-An4uF7Sr.js";import{Q as T}from"./QPage-DZO8eRE2.js";import{s as g}from"./supabase-3Ri18K4t.js";import{u as N}from"./use-quasar-C6NPZew5.js";import"./QList-CHOuisuT.js";import"./QSelect-DCR9V7w2.js";import"./QChip-BZCpNEhF.js";import"./QItem-rw1yFefp.js";import"./QItemLabel-l38w8CTe.js";import"./QMenu-DrHU5L3Z.js";import"./selection-CdExz2ft.js";import"./format-CJebrXOQ.js";import"./use-fullscreen-BzphbkPZ.js";const P={class:"row items-center justify-between q-mb-lg"},S={class:"row q-gutter-md"},ee={__name:"AdminApprovalsPage",setup(E){const s=N(),c=p(!1),v=p([]),n=p("pending"),i=p(""),_=[{name:"email",label:"Email",field:"email",align:"left",sortable:!0},{name:"whatsapp",label:"WhatsApp",field:"whatsapp_number",align:"left"},{name:"status",label:"Status",field:"is_approved",align:"center"},{name:"actions",label:"Actions",field:"actions",align:"center"}],h=x(()=>{let t=v.value;if(n.value==="pending"?t=t.filter(e=>!e.is_approved):n.value==="approved"&&(t=t.filter(e=>e.is_approved)),i.value){const e=i.value.toLowerCase();t=t.filter(a=>a.email?.toLowerCase().includes(e)||a.whatsapp_number?.includes(e))}return t}),d=async()=>{c.value=!0;try{const{data:t,error:e}=await g.from("profiles").select("*").order("created_at",{ascending:!1});if(e)throw e;v.value=t}catch(t){s.notify({type:"negative",message:"Error fetching users: "+t.message})}finally{c.value=!1}},y=async(t,e)=>{try{const{error:a}=await g.from("profiles").update({is_approved:e}).eq("id",t.id);if(a)throw a;s.notify({type:"positive",message:`User ${e?"approved":"disapproved"} successfully`}),d()}catch(a){s.notify({type:"negative",message:"Action failed: "+a.message})}},k=t=>{s.dialog({title:"Confirm Deletion",message:`Are you sure you want to delete ${t.email}? This action cannot be undone.`,cancel:!0,persistent:!0}).onOk(async()=>{try{const{error:e}=await g.from("profiles").delete().eq("id",t.id);if(e)throw e;s.notify({type:"positive",message:"User deleted"}),d()}catch(e){s.notify({type:"negative",message:"Delete failed: "+e.message})}})};return C(()=>{d()}),(t,e)=>(m(),u(T,{class:"q-pa-md"},{default:l(()=>[r("div",P,[e[2]||(e[2]=r("div",null,[r("h1",{class:"text-h4 text-weight-bold text-grey-9 q-mb-xs"},"User Management"),r("div",{class:"text-grey-6"},"Manage tuition center approvals and access")],-1)),r("div",S,[o(Q,{modelValue:n.value,"onUpdate:modelValue":[e[0]||(e[0]=a=>n.value=a),d],flat:"","toggle-color":"primary",options:[{label:"Pending",value:"pending"},{label:"Approved",value:"approved"},{label:"All",value:"all"}]},null,8,["modelValue"]),o(A,{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=a=>i.value=a),dense:"",outlined:"",placeholder:"Search...","bg-color":"white"},{append:l(()=>[o(q,{name:"search"})]),_:1},8,["modelValue"])])]),o(U,{flat:"",bordered:"",class:"rounded-borders"},{default:l(()=>[o($,{rows:h.value,columns:_,"row-key":"id",flat:"",loading:c.value,"no-data-label":"No users found"},{"body-cell-status":l(a=>[o(w,{props:a,class:"text-center"},{default:l(()=>[o(D,{color:a.row.is_approved?"green":"orange",rounded:""},{default:l(()=>[V(B(a.row.is_approved?"Approved":"Pending"),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-actions":l(a=>[o(w,{props:a,class:"q-gutter-sm text-center"},{default:l(()=>[a.row.is_approved?(m(),u(f,{key:1,flat:"",dense:"",color:"orange-9",label:"Disapprove",icon:"block","no-caps":"",onClick:b=>y(a.row,!1)},null,8,["onClick"])):(m(),u(f,{key:0,flat:"",dense:"",color:"green",label:"Approve",icon:"check","no-caps":"",onClick:b=>y(a.row,!0)},null,8,["onClick"])),o(f,{flat:"",dense:"",color:"red",label:"Delete",icon:"delete","no-caps":"",onClick:b=>k(a.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1}))}};export{ee as default};
