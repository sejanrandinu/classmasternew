import{r as p,b as h,f as _,k as Q,m as x,n as s,q as l,p as a,W as k,t as q,a9 as C,Q as u,v as A}from"./index-BCQP80hx.js";import{Q as D}from"./QBadge-Brhg3mLW.js";import{Q as U,a as f}from"./QTable-An4uF7Sr.js";import{Q as V}from"./QPage-DZO8eRE2.js";import{s as m}from"./supabase-3Ri18K4t.js";import{u as B}from"./use-quasar-C6NPZew5.js";import"./QList-CHOuisuT.js";import"./QSelect-DCR9V7w2.js";import"./QChip-BZCpNEhF.js";import"./QItem-rw1yFefp.js";import"./QItemLabel-l38w8CTe.js";import"./QMenu-DrHU5L3Z.js";import"./selection-CdExz2ft.js";import"./format-CJebrXOQ.js";import"./use-fullscreen-BzphbkPZ.js";const L={class:"row items-center justify-between q-mb-lg"},N={class:"row q-gutter-md"},R={__name:"ApprovedUsersPage",setup(T){const r=B(),i=p(!1),d=p([]),n=p(""),g=[{name:"email",label:"Email",field:"email",align:"left",sortable:!0},{name:"whatsapp",label:"WhatsApp",field:"whatsapp_number",align:"left"},{name:"created_at",label:"Joined Date",field:"created_at",align:"left",sortable:!0,format:t=>new Date(t).toLocaleDateString()},{name:"status",label:"Status",field:"is_approved",align:"center"},{name:"actions",label:"Actions",field:"actions",align:"center"}],v=h(()=>{if(!n.value)return d.value;const t=n.value.toLowerCase();return d.value.filter(e=>e.email?.toLowerCase().includes(t)||e.whatsapp_number?.includes(t))}),c=async()=>{i.value=!0;try{const{data:t,error:e}=await m.from("profiles").select("*").eq("is_approved",!0).order("created_at",{ascending:!1});if(e)throw e;d.value=t}catch(t){r.notify({type:"negative",message:"Error fetching users: "+t.message})}finally{i.value=!1}},y=async t=>{try{const{error:e}=await m.from("profiles").update({is_approved:!1}).eq("id",t.id);if(e)throw e;r.notify({type:"positive",message:"User disapproved and moved to pending"}),c()}catch(e){r.notify({type:"negative",message:"Action failed: "+e.message})}},b=t=>{r.dialog({title:"Confirm Deletion",message:`Warning: This will permanently delete ${t.email}. Are you sure?`,cancel:!0,persistent:!0,ok:{color:"red",flat:!0}}).onOk(async()=>{try{const{error:e}=await m.from("profiles").delete().eq("id",t.id);if(e)throw e;r.notify({type:"positive",message:"User deleted"}),c()}catch(e){r.notify({type:"negative",message:"Delete failed: "+e.message})}})};return _(()=>{c()}),(t,e)=>(x(),Q(V,{class:"q-pa-md"},{default:s(()=>[l("div",L,[e[1]||(e[1]=l("div",null,[l("h1",{class:"text-h4 text-weight-bold text-grey-9 q-mb-xs"},"Approved Users"),l("div",{class:"text-grey-6"},"List of active tuition centers currently using the platform")],-1)),l("div",N,[a(k,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=o=>n.value=o),dense:"",outlined:"",placeholder:"Search members...","bg-color":"white",style:{width:"300px"}},{append:s(()=>[a(q,{name:"search"})]),_:1},8,["modelValue"])])]),a(C,{flat:"",bordered:"",class:"rounded-borders"},{default:s(()=>[a(U,{rows:v.value,columns:g,"row-key":"id",flat:"",loading:i.value,"no-data-label":"No approved users found"},{"body-cell-status":s(o=>[a(f,{props:o,class:"text-center"},{default:s(()=>[a(D,{color:"green",rounded:""},{default:s(()=>[...e[2]||(e[2]=[A(" Active ",-1)])]),_:1})]),_:1},8,["props"])]),"body-cell-actions":s(o=>[a(f,{props:o,class:"q-gutter-sm text-center"},{default:s(()=>[a(u,{flat:"",dense:"",color:"orange-9",label:"Disapprove",icon:"block","no-caps":"",onClick:w=>y(o.row)},null,8,["onClick"]),a(u,{flat:"",dense:"",color:"red",label:"Delete",icon:"delete","no-caps":"",onClick:w=>b(o.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})]),_:1}))}};export{R as default};
